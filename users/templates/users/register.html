{% extends 'layout.html' %}

{% block title %}
    Register
{% endblock %}

{% block main %}

    <!-- boostrap5 loading spinner -->
    <div id="loadingSpinner" class="d-flex align-items-center justify-content-center" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.7); z-index: 9999;">
        <div>
        <strong>Loading...</strong>
        <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div>
        </div>
    </div>
    <!-- /boostrap5 loading spinner -->

    <!-- instructional text -->
    <div class="container-fluid ps-0 mb-1">
        <div class="container-fluid container-instructions-start-bold">
            Please complete all the fields below and click "submit" to create your account.
        </div>
        <div class="container-fluid container-instructions-start">
            Required fields
        </div>
    </div>
    <!-- /instructional text -->

    <!-- register form -->
    <form action='{% url "users:register" %}' method='post'>
        {% csrf_token %}
        {{ form.non_field_errors }}

        <!-- section header: Personal info -->
        <div class="container-fluid ps-0 mb-0">
            <div class='container-fluid container-instructions-start-bold mb-0 mt-4' style='font-style: italic'>
                Personal information
            </div>
        </div>
        <hr>
        <!-- /section header: Personal info -->

        <!-- name_first -->
        <div class='user_input_registration row'>
            <div class='col-sm-2' style='align-self: flex-start; text-align: start'>
                <label for="id_first_name" class="form-label-start-req-bold">First name:</label>
            </div>
            <div class='col-sm-8 col-md-6 col-lg-4'>
                {{ form.name_first }}
                {% if form.first_name.errors %}
                    <div class='text-danger mt-2'>
                        {% for error in form.first_name.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- /first_name -->

        <!-- last_name -->
        <div class='user_input_registration row'>
            <div class='col-sm-2' style='align-self: flex-start; text-align: start'>
                <label for="id_last_name" class="form-label-start-req-bold">Last name:</label>
            </div>
            <div class='col-sm-8 col-md-6 col-lg-4'>
                {{ form.name_last }}
                {% if form.name_last.errors %}
                    <div class='text-danger mt-2'>
                        {% for error in form.last_name.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- /last_name -->

        <!-- username -->
        <div class='user_input_registration row'>
            <div class='col-sm-2' style='align-self: flex-start; text-align: start'>
                <label for="id_username" class="form-label-start-req-bold">Username:</label>
            </div>
            <div class='col-sm-8 col-md-6 col-lg-4'>
                {{ form.username }}
                {% if form.username.errors %}
                    <div class='text-danger mt-2'>
                        {% for error in form.username.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- /username -->

        <!-- username validation -->
        <div class='user_input_registration row'>
            <label class='col-sm-2 form-label-start-req-bold'></label>
            <div class='col-sm-8 col-md-6 col-lg-4 container-input-validation' id='username_validation' name='username_validation' style='display: none;'>
                    <a></a>
            </div>
            <div class='col-sm-2 mt-2'>
            </div>
        </div>
        <!-- /username validation -->

        <!-- email -->
        <div class='user_input_registration row'>
            <div class='col-sm-2' style='align-self: flex-start; text-align: start'>
                <label for="id_email" class="form-label-start-req-bold">Email address:</label>
            </div>
            <div class='col-sm-8 col-md-6 col-lg-4'>
                {{ form.email }}
                {% if form.email.errors %}
                    <div class='text-danger mt-2'>
                        {% for error in form.email.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- /email -->

        <!-- email validation -->
        <div class='user_input_registration row'>
            <label class='col-sm-2 form-label-start-req-bold'></label>
            <div class='col-sm-8 col-md-6 col-lg-4 container-input-validation' id='email_validation' name='email_validation' style='display: none;'>
                    <a></a>
            </div>
            <div class='col-sm-2 mt-2'>
            </div>
        </div>
        <!-- /email validation -->
        
        <!-- password -->
        <div class='user_input_registration row'>
            <div class='col-sm-2' style='align-self: flex-start; text-align: start'>
                <label for="id_password" class="form-label-start-req-bold">Password:</label>
            </div>
            <div class='col-sm-8 col-md-6 col-lg-4'>
                {{ form.password }}
                {% if form.password.errors %}
                    <div class='text-danger mt-2'>
                        {% for error in form.password.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>

        <div class='user-input-validation row'>
            <label class='col-sm-2 form-label-start-req-bold'></label>
            <div class='col-sm-8 col-md-6 col-lg-4 container-input-validation' style='color: black' id='password_validation' name='password_validation'>
                <div class='col-sm-8 col-md-6 col-lg-4 container-input-validation-pw-bullets'>
                    <a>Password must:</a>
                    <ul>
                        <li id='pw_min_tot_chars_li' name='pw_min_tot_chars_li'>Include at least {{ pw_req_length }} characters total, including at least: 
                        
                        <li class="custom-bullet-secondary" id='pw_min_letters_li' name='pw_min_letters_li'>{{ pw_req_letter }} letters</li>
                        
                        <li class="custom-bullet-secondary" id='pw_min_num_li' name='pw_min_num_li'>{{ pw_req_num }} numbers</li>
                        
                        <li class="custom-bullet-secondary" id='pw_min_sym_li' name='pw_min_sym_li'>{{ pw_req_symbol }} symbols from the following list: {{ user_input_allowed_symbols }}</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- /password -->

        <!-- password_confirmation -->
        <div class='user_input_registration row'>
            <div class='col-sm-2' style='align-self: flex-start; text-align: start'>
                <label for="id_password_confirmation" class="form-label-start-req-bold">Confirm password:</label>
            </div>
            <div class='col-sm-8 col-md-6 col-lg-4'>
                {{ form.password_confirmation }}
                {% if form.password_confirmation.errors %}
                    <div class='text-danger mt-2'>
                        {% for error in form.password_confirmation.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>

        <div class='user-input-validation row'>
            <label class='col-sm-2 form-label-start-req-bold'></label>
            <div class='col-sm-8 col-md-6 col-lg-4 container-input-validation' style='color: black' id='password_confirmation_validation' name='password_confirmation_validation'>
                <div class='col-sm-8 col-md-6 col-lg-4 container-input-validation-pw-bullets'>
                    <a>Password confirmation must:</a>
                    <ul>
                        <li id='password_confirmation_validation_match' name='password_confirmation_validation_match'>Match password</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- /password_confirmation -->

        <!-- section header: Accounting and tax info -->
        <div class='container-fluid ps-0 mb-1'>
            <div class='container-fluid container-instructions-start-bold mb-0 mt-4' style='font-style: italic'>
                Accounting and tax information
            </div>
            <hr>
        </div>
        <!-- /section header: Accounting and tax info -->

        <!-- cash_initial -->
        <div class='user_input_registration row'>
            <div class='col-sm-2' style='align-self: flex-start; text-align: start'>
                <label for="id_cash_initial" class="form-label-start-req-bold">Initial cash:</label>
            </div>
            <div class='col-sm-8 col-md-6 col-lg-4'>
                {{ form.cash_initial }}
                {% if form.cash_initial.errors %}
                    <div class='text-danger mt-2'>
                        {% for error in form.cash_initial.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- /cash_initial -->
        
        
        <!-- accounting_method -->
        <div class='user_input_registration row'>        
            {{ form.accounting_method.label(class='col-sm-2 form-label-start-req-bold') }}
            <div class='col-sm-8 col-md-6 col-lg-4'>
                {{ form.accounting_method(class='form-control', id='accounting_method') }}
            </div>
            <div class='col-sm-2 mt-2'>
                <i class="fas fa-question-circle ml-2" data-bs-toggle="tooltip" data-bs-placement="top" title='"FIFO" (first-in, first-out) means that when someone sells a given amount of shares in a company, the oldest shares are assumed to be the first sold. This is the policy followed by most tax authorities.'></i>
            <div>
            </div>
                {% if form.accounting_method.errors %}
                    <div class='text-danger'>
                        {% for error in form.accounting_method.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- /accounting_method -->

        <!-- tax_loss_offsets -->
        <div class='user_input_registration row'>        
            {{ form.tax_loss_offsets.label(class='col-sm-2 form-label-start-req-bold') }}
            <div class='col-sm-8 col-md-6 col-lg-4'>
                {{ form.tax_loss_offsets(class='form-control', id='tax_loss_offsets') }}
            </div>
            <div class='col-sm-2 mt-2'>
                <i class="fas fa-question-circle ml-2" data-bs-toggle="tooltip" data-bs-placement="top" title='"FIFO" (first-in, first-out) means that when someone sells a given amount of shares in a company, the oldest shares are assumed to be the first sold. This is the policy followed by most tax authorities.'></i>
            <div>
            </div>
                {% if form.tax_loss_offsets.errors %}
                    <div class='text-danger'>
                        {% for error in form.tax_loss_offsets.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- /tax_loss_offsets -->

        <!-- tax_rate_STCG -->
        <div class='user_input_registration row'>
            <label for="{{ form.tax_rate_STCG.id_for_label }}" class='col-sm-2 form-label-start-req-bold'>{{ form.tax_rate_STCG.label }}</label>
            <div class='col-sm-8 col-md-6 col-lg-4'>
                <span id='tax_rate_STCG_value'>
                    {{ form.tax_rate_STCG.value|default_if_none:form.tax_rate_STCG.field.initial|stringformat:".2f" }}%
                </span>
                {{ form.tax_rate_STCG }}
                <!-- Note: Django does not have a direct equivalent to Flask-WTF's hidden field that's separate from the main field, so adjust accordingly if needed -->
                <i class="fas fa-question-circle ml-2" data-toggle="tooltip" title='The tax applied to profits on share sales when the holding period was < 365 days.'></i>
                {% if form.tax_rate_STCG.errors %}
                    <div class='text-danger'>
                        {% for error in form.tax_rate_STCG.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- /tax_rate_STCG --> 
        
        <!-- tax_rate_LTCG -->
        <div class='user_input_registration row'>
            <label for="{{ form.tax_rate_LTCG.id_for_label }}" class='col-sm-2 form-label-start-req-bold'>{{ form.tax_rate_LTCG.label }}</label>
            <div class='col-sm-8 col-md-6 col-lg-4'>
                <span id='tax_rate_LTCG_value'>
                    {{ form.tax_rate_LTCG.value|default_if_none:form.tax_rate_LTCG.field.initial|stringformat:".2f" }}%
                </span>
                {{ form.tax_rate_LTCG }}
                <!-- Note: Django does not have a direct equivalent to Flask-WTF's hidden field that's separate from the main field, so adjust accordingly if needed -->
                <i class="fas fa-question-circle ml-2" data-toggle="tooltip" title='The tax applied to profits on share sales when the holding period was < 365 days.'></i>
                {% if form.tax_rate_LTCG.errors %}
                    <div class='text-danger'>
                        {% for error in form.tax_rate_LTCG.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- /tax_rate_LTCG -->

        <!-- cancel and submit buttons-->
        <div class='row' style='margin-top: 20px; margin-bottom: 10px;'>
            <div class='col-sm-6 col-md-4 col-lg-3'>
                <a href='{% url "users:login" %}' class='btn btn-secondary w-100' id='cancel_button'>Back</button>
            </div>
            <div class='col-sm-6 col-md-4 col-lg-3'>
                <button type='submit' class='btn btn-success w-100' id='submit_button' disabled>Log In</button>
            </div>
        </div>
        <!-- /cancel and submit buttons-->

    </form>
    <!-- /register form -->

{% endblock %}
